<!DOCTYPE html>

{% load staticfiles %} <!--Load the static folder will be referenced later-->

<html>
	<head>
		<title>Ocu-Pants</title>
		<meta charset="utf-8">
        <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="excanvas.js"></script><![endif]-->
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="http://cdn.jsdelivr.net/jqplot/1.0.8/jquery.jqplot.min.js"></script>
		<link rel="stylesheet" href="{% static 'css/style.css' %}"> <!--load style.css from static folder-->
        <link rel="stylesheet" type="text/css" href="{% static 'Libraries/jqplot/jquery.jqplot.css' %}" />
	</head>
	
	<body>
       <form action="" method="POST">{% csrf_token %} <!--form to select room using post method and sending a csrf token-->
            <select name="roomForm" onchange="this.form.submit()"> <!--submit on change-->
                <option value="" selected></option>
                {% for room in roomList %} <!--automatically generate the form options from roomList-->
                <option value="{{ room.room }}">{{ room.room }}</option>
            {% endfor %}
            </select>
        </form>
        
        <div class="centered"> <!--Display each field of the returned room object-->
            <h3>{{ roomObj.0.campus }}  {{ roomObj.0.building }}  {{ roomObj.0.room }}  {{ roomObj.0.capacity }}</h3><br>
        </div>
        
        <div class="centered" id="tableDiv" style="Display: block">
            <table> <!--Display the table headings-->
                <tr><th></th><th>Monday</th><th>Tuesday</th><th>Wednesday</th><th>Thursday</th><th>Friday</th></tr> 

                {% for y in timeList %} <!--build rows by identifing each timeslot 9am - 5pm in turn-->

                    <tr><th>{{ y }}</th>
                        
                    {% for timeSlot in roomSchedule %} <!--build columns by cycling through the object and displaying the module with the correct time-->
                        {% if timeSlot.datetime.hour == y.hour  %}
                            <td id="{{ timeSlot.timemoduleid }}" onclick="CellClick({{ timeSlot.timemoduleid }})">{{ timeSlot.module.modulename }}</td> <!--Display the cell-->
                        {% endif %}
                    {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>
        <div class="centered" id="testDiv">test</div>
        <div class="centered" id="graphDiv" style="height:300px; width:400px;">
            
            
            
            
        </div>
    </body>
    
    <script>
        function CellClick(x) {
            var timeModuleId = x;
            $.ajax({
                method: "POST",
                data: {'timeModuleId': timeModuleId, csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,},
                url: "/test",
                success: function(result) {
                    var graphData = result;
                    document.getElementById('testDiv').innerHTML = graphData;

                    document.getElementById('graphDiv').innerHTML = "";
                    
                    $(document).ready(function(){
                        var plot1 = $.jqplot ('graphDiv', [graphData]);
                    });
                }
            });
        };           
    </script>    
</html>                